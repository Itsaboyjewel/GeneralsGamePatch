; Patch104p Jundiyy 20/10/2021 Implement Repair Drone for Tech War Factory and custom maps.

;------------------------------------------------------------------------------
Object VehicleRepairDrone

  ; *** ART Parameters ***

  SelectPortrait         = SSRepairDrone ;SARAmblnce_L ;Could use this as well.
  ButtonImage            = SSRepairDrone ;SARAmblnce

  Draw = W3DTruckDraw ModuleTag_01
    OkToChangeModelColor = Yes
    ParticlesAttachedToAnimatedBones = Yes

    DefaultConditionState
      Model             = AVRepairDr
      Animation         = AVRepairDr.AVRepairDr
      AnimationMode     = MANUAL
      Flags             = MAINTAIN_FRAME_ACROSS_STATES
    End

    ConditionState      = REALLYDAMAGED
      Model             = AVRepairDr_D
      Animation         = AVRepairDr_D.AVRepairDr_D
      AnimationMode     = MANUAL
      Flags             = MAINTAIN_FRAME_ACROSS_STATES
    End

    ConditionState      = ACTIVELY_CONSTRUCTING
      Model             = AVRepairDr
      Animation         = AVRepairDr.AVRepairDr
      AnimationMode     = LOOP
      Flags             = START_FRAME_FIRST
      ParticleSysBone   = Barrel01 GenericLaserFlare
      ParticleSysBone   = Muzzle01 SparksMedium
      ParticleSysBone   = Muzzle01 CountermeasureFlareParticleSys
      ParticleSysBone   = Muzzle01 GenericBlueLaserFlare
    End
    AliasConditionState = ATTACKING

    ConditionState      = REALLYDAMAGED ACTIVELY_CONSTRUCTING
      Model             = AVRepairDr_D
      Animation         = AVRepairDr_D.AVRepairDr_D
      AnimationMode     = LOOP
      Flags             = START_FRAME_FIRST
      ParticleSysBone   = Barrel01 GenericLaserFlare
      ParticleSysBone   = Muzzle01 SparksMedium
      ParticleSysBone   = Muzzle01 CountermeasureFlareParticleSys
      ParticleSysBone   = Muzzle01 GenericBlueLaserFlare
    End
    AliasConditionState = REALLYDAMAGED ATTACKING

    ConditionState      = RUBBLE
      Model             = AVRepairDr_D1
    End

    TrackMarks = EXTireTrack.tga
    Dust = RocketBuggyDust
    DirtSpray = RocketBuggyDirtSpray
    PowerslideSpray = RocketBuggyDirtPowerSlide

    LeftFrontTireBone  = Tire01
    RightFrontTireBone = Tire02
    LeftRearTireBone   = Tire03
    RightRearTireBone  = Tire04
    TireRotationMultiplier = 0.2        ; this * speed = rotation.
    PowerslideRotationAddition = 2.5    ; This speed is added to the rotation speed when powersliding.
  End

  ; ***DESIGN parameters ***
  DisplayName      = OBJECT:RepairDrone
  Side = America
  EditorSorting   = VEHICLE

  TransportSlotCount = 1                 ;how many "slots" we take in a transport (0 == not transportable)

  ArmorSet
    Conditions      = None
    Armor           = SentryDroneArmor
    DamageFX        = TruckDamageFX
  End
  BuildCost       = 500
  BuildTime       = 6.0          ;in seconds
  VisionRange     = 150
  ShroudClearingRange = 150
  ExperienceValue    = 50 100 150 400 ;Experience point value at each level
  ExperienceRequired = 0 150 450 900 ;Experience points needed to gain each level
  IsTrainable     = No
  CrusherLevel           = 0  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
  CrushableLevel         = 2  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
  CommandSet    = GenericCommandSet ;Allows mixed units to still use Attack Move and Guard Mode.

  ; *** AUDIO Parameters *** ;Using Sentry Drone sounds for now.
  VoiceSelect           = SentryDroneVoiceSelect
  VoiceMove             = SentryDroneVoiceMove
  VoiceGuard            = SentryDroneVoiceMove
  VoiceAttack           = SentryDroneVoiceMove
  SoundMoveStart        = SentryDroneMoveStart
  SoundMoveStartDamaged = SentryDroneMoveStart
  UnitSpecificSounds
    ; These have the syntax of SomeNameSomewhereInCode = SomeNameSomewhereInLookupINIs
    VoiceCreate         = SentryDroneVoiceCreate
    VoiceRepair         = SentryDroneVoiceMove
    VoiceTaskComplete   = SentryDroneVoiceMove
    TurretMoveStart     = NoSound
    TurretMoveLoop      = NoSound
    VoiceEnter          = NoSound
    Deploy              = NoSound
    Undeploy            = NoSound
  End


  ; *** ENGINEERING Parameters ***
  RadarPriority = UNIT
  KindOf = PRELOAD SELECTABLE CAN_ATTACK CAN_CAST_REFLECTIONS VEHICLE SCORE DRONE DOZER

  Body = ActiveBody ModuleTag_02
    MaxHealth       = 300.0
    InitialHealth   = 300.0
    SubdualDamageCap = 600
    SubdualDamageHealRate = 500
    SubdualDamageHealAmount = 50
  End

  Behavior = DozerAIUpdate ModuleTag_03
    RepairHealthPercentPerSecond = 2%    ; % of max health to repair each second
    BoredTime                    = 5000  ; in milliseconds
    BoredRange                   = 150   ; when bored, we look this far away to do something
  End
  Locomotor = SET_NORMAL BasicTankLocomotor

  Behavior = PhysicsBehavior ModuleTag_04
    Mass = 50.0
  End

  Behavior = SlowDeathBehavior ModuleTag_05
    DeathTypes = ALL -CRUSHED -SPLATTED
    DestructionDelay  = 500
    DestructionDelayVariance  = 100
    FX  = INITIAL  FX_GenericTankDeathEffect
    OCL = FINAL OCL_AmericaVehicleRepairDroneDie
    FX =  FINAL FX_AmericaVehicleTomahawkDeathExplosion
  End

  Behavior = DestroyDie ModuleTag_07
    DeathTypes = NONE +CRUSHED +SPLATTED
  End

  Behavior = FXListDie ModuleTag_08
    DeathTypes = NONE +CRUSHED +SPLATTED
    DeathFX = FX_CarCrush
  End

  Behavior = CreateCrateDie ModuleTag_09
    CrateData = SalvageCrateData
   ;CrateData = EliteTankCrateData
   ;CrateData = HeroicTankCrateData
  End

  Behavior = TransitionDamageFX ModuleTag_10
    ReallyDamagedParticleSystem1 = Bone:Smoke RandomBone:Yes PSys:SmokeSmallContinuous01
    ReallyDamagedFXList1 = Loc: X:0 Y:0 Z:0 FXList:FX_BattleMasterDamageTransition
  End

  Behavior = FlammableUpdate ModuleTag_21
    AflameDuration = 5000         ; If I catch fire, I'll burn for this long...
    AflameDamageAmount = 3       ; taking this much damage...
    AflameDamageDelay = 500       ; this often.
  End

  Behavior = AutoHealBehavior ModuleTag_Heal23
    HealingAmount     = 5
    HealingDelay      = 1000 ; msec
    Radius            = 100.0f
    StartsActive      = Yes
    KindOf            = VEHICLE
    ForbiddenKindOf   = AIRCRAFT
    SkipSelfForHealing = Yes
  End

  Geometry = BOX
  GeometryMajorRadius = 11.0
  GeometryMinorRadius = 7.0
  GeometryHeight = 10.0
  GeometryIsSmall = Yes
  Shadow = SHADOW_VOLUME

End
